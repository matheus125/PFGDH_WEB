<div class="card card-info card-outline mb-4">
  <div class="card-header">
    <h3 class="card-title">CENTRO DE CUSTOS</h3>
  </div>

  <!-- Mensagem de Erro -->
  <div id="error-message" class="alert alert-danger d-none" role="alert"></div>

  <form id="form" class="needs-validation" novalidate>
    <div class="card-body">
      <div class="mb-3">
        <label for="nome_passageiros" class="form-label">Nome</label>
        <input type="text" id="nome_passageiros" name="nome_passageiros" class="form-control" required />
      </div>

      <div class="mb-3">
        <label for="telefone" class="form-label">Telefone</label>
        <input type="tel" id="telefone" name="telefone" class="form-control" required />
      </div>

      <div class="mb-3">
        <label for="email" class="form-label">Email</label>
        <input type="email" id="email" name="email" class="form-control" required placeholder="seuemail@exemplo.com" />
      </div>

      <div id="errorDiv" class="alert alert-danger d-none" role="alert"></div>

      <button type="submit" class="btn btn-primary">Salvar</button>
  </form>

  <div id="toast-success" class="toast" role="alert" aria-live="assertive" aria-atomic="true" data-bs-delay="3000">
    <div class="toast-body">Passageiro salvo com sucesso!</div>
  </div>
</div>

<!-- Toast estilo AdminLTE -->
<div class="toast bg-success text-white position-fixed bottom-0 end-0 m-3" id="toast-success" role="alert"
  aria-live="assertive" aria-atomic="true" data-delay="4000">
  <div class="toast-header bg-success text-white">
    <strong class="me-auto">Sucesso</strong>
    <small>agora</small>
    <button type="button" class="ml-2 mb-1 close text-white" data-dismiss="toast">&times;</button>
  </div>
  <div class="toast-body">
    Formulário enviado com sucesso!
  </div>
</div>

<!-- Scripts necessários -->
<!-- Inputmask (com jQuery) -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.7.1/jquery.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/inputmask/5.0.8/jquery.inputmask.min.js"></script>

<script>
  document.addEventListener("DOMContentLoaded", function () {
    const form = document.getElementById("form");
    const toastElement = document.getElementById("toast-success");
    const toast = new bootstrap.Toast(toastElement);
    const errorDiv = document.getElementById("errorDiv");

    form.addEventListener("submit", async function (event) {
      event.preventDefault();
      event.stopPropagation();

      errorDiv.textContent = "";
      errorDiv.classList.add("d-none");

      if (!form.checkValidity()) {
        form.classList.add("was-validated");
        return;
      }

      // Validação extra para email via regex
      const email = form.email.value.trim();
      const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
      if (!emailRegex.test(email)) {
        errorDiv.textContent = "Por favor, informe um email válido.";
        errorDiv.classList.remove("d-none");
        return;
      }

      const data = {
        nome_passageiros: form.nome_passageiros.value.trim(),
        telefone: form.telefone.value.trim(),
        email: email
      };

      try {
        const response = await fetch("/admin/passageiros/create", {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify(data)
        });

        if (!response.ok) {
          const errorText = await response.text();
          throw new Error(`Erro no servidor: ${response.status}\n${errorText}`);
        }

        const result = await response.json();

        if (result.status === "success") {
          toast.show();
          form.reset();
          form.classList.remove("was-validated");
          errorDiv.classList.add("d-none");
        } else {
          errorDiv.textContent = result.message || "Erro ao salvar os dados. Verifique os campos.";
          errorDiv.classList.remove("d-none");
        }
      } catch (error) {
        errorDiv.textContent = error.message || "Erro de conexão ou resposta inválida.";
        errorDiv.classList.remove("d-none");
        console.error("Erro ao enviar:", error);
      }
    });
  });
</script>